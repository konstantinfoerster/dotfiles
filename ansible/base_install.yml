---
- hosts: localhost
  become: true
  gather_facts: false
  vars:
    - main_disk: /dev/sda
    - main_disk_password: "test123"
    - crypted_disk_name: cryptdisk

  pre_tasks:
    - name: Running from iso?
      ansible.builtin.command: uname -a
      changed_when: false
      register: uname_out
    - ansible.builtin.set_fact:
        hostlist: "{{ 'chroot' if 'archiso' in uname_out.stdout else 'localhost' }}"
        is_archiso: "{{ true if 'archiso' in uname_out.stdout else false }}"
        cacheable: true
    - name: Running from iso?
      debug:
        msg: "Is iso {{ is_archiso }}"

  tasks:
    - name: Setup hard drive
      import_tasks: tasks/storage.yml
      when: is_archiso == true

    - name: Prepare base system
      import_tasks: tasks/prepare_base.yml
      when: is_archiso == true

- import_playbook: main.yml
  tags:
    - always
